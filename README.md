# Kubernetes POD Sample

**Задача:** на примере клиент-серверного решения продемонстрировать процесс создания POD.  
**Что используется:** MiniKube; Server - Python + Flask; Client - готовый образ с Curl.

Серверное приложение будет возвращать текущую дату по маршруту /date на всех доступных сетевых интерфейсах на порту 8080.
Клиент будет бесконечно запрашивать дату у сервера с помощью утилиты Curl.

В примере в POD находятся оба контейнера (Server и Client) для упрощения.  
В реальной жизни нужно придерживаться правила "Один POD - один контенер".

## Алгоритм
1. Собираю сервер используя Dockerfile, requirements.txt, app.py, назвав его server, с тегом 1.0  
  <code>docker build -t server:1.0</code>  
  При сборке будет установлен необходимый для сервиса компонент - Flask, указанный в requirements.txt  
  В app.py host='0.0.0.0' и port='8080' для того, чтобы сервер слушал входящие соединения на всех доступных сетевых интерфейсах на порту 8080. По endpoint'у /date будет отдаваться текущая дата.  
  Проверить созданный образ можно командой:  
  <code>docker image</code>
  
2. Чтобы задействовать созданный образ можно использовать docker registry или, в данном случае, воспользоваться дополнением minikube docker registry:  
  <code>minikube image load server:1.0</code>  
  Проверить загруженные образы можно командой:  
  <code>minikube image list</code>
  
3. Создаю спецификацию POD с контейнерами.
   Контейнер сервера - использую созданный образ server:1.0.  
   Контейнер клиента - использую образ curlimages/curl:7.76.0. Entrypoint не указан в качетстве запуска явно указываю, что нужно делать - запускаю sh, дплее запускаю цикл с запросом к серверу.  
   Применить эту конфигурацию можно командой:  
   <code>cubectl create -f pod_app.yaml</code>  
   Проверить состояние POD'ов можно командой:  
   <code>kubectl get po</code>  
   Все app должны быть в состоянии Running.
   
4. Вроверка работы.
   Проверить работу сервера или клиента можно просмотрев их логи с помощью команд:  
   <code>kubectl logs -f app -c server</code> - сервер  
   <code>kubectl logs -f app -c client</code> - клиент

## POD
POD является минимальной единицей Kubernets, которая приводит к запуску контейнеров.  
Нет POD - нет контейнера.  
Один POD - один контейнер.  
Контейнеры в POD не обязаны быть на одной физической/виртуальной машине.

## Статусы запуска POD
* Pending — объект создан 
* Running — все контейнеры Podа запущены
* Succeeded — все контейнеры корректно завершили работу
* Failed — все контейнеры остановлены
* Unknown — kube-apiserver не в курсе, что происходит с подом

## Схемы
<img title="Kubernetes elements" height="25" src="images/kubelem.svg">
